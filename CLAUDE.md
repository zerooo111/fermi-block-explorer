# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a **Fermi Block Explorer** - a modern, real-time blockchain explorer for the Fermi rollup. The application connects to a Fermi rollup node REST API and WebSocket interface to display blocks, transactions, markets, and events in real-time.

Built with React 19, TanStack Router, TanStack Query, and Tailwind CSS v4. Uses Bun as the package manager and runtime, Vite for development and building, and Biome for linting/formatting.

## Essential Commands

### Development
```bash
bun install                  # Install dependencies
bun --bun run dev           # Start dev server on port 3000
bun --bun run serve         # Preview production build
```

### Building
```bash
bun --bun run build         # Production build (runs vite build && tsc)
```

### Testing
```bash
bun --bun run test          # Run all tests with Vitest
```

### Code Quality
```bash
bun --bun run lint          # Lint code with Biome
bun --bun run format        # Format code with Biome
bun --bun run check         # Run both lint and format checks
```

### Adding Components
```bash
pnpx shadcn@latest add <component-name>    # Add Shadcn UI components
```

## Architecture

### Routing Architecture
- **File-based routing** powered by TanStack Router
- Routes are defined as files in `src/routes/`
- Route tree is auto-generated at `src/routeTree.gen.ts` (excluded from linting)
- Root layout defined in `src/routes/__root.tsx`
  - Includes `Header` component, `<Outlet />` for child routes, and TanStack DevTools
  - Root route uses context typing with `MyRouterContext` interface for type-safe access to `QueryClient`

### State & Data Fetching
- **TanStack Query** for server state management
  - Query client created in `src/integrations/tanstack-query/root-provider.tsx`
  - Context passed to router for integration between Router and Query
  - DevTools integrated into unified TanStack DevTools panel
- Router loaders can be used for route-level data fetching
- Router context provides QueryClient to all routes via `MyRouterContext` interface

### Styling
- **Tailwind CSS v4** with `@tailwindcss/vite` plugin
- Global styles in `src/styles.css`
- **Shadcn UI** components (New York style, Zinc base color, Lucide icons)
  - Configured with path aliases: `@/components`, `@/lib/utils`, `@/components/ui`
  - CSS variables enabled for theming

### Code Organization
- `src/main.tsx` - Application entry point, router setup, providers
- `src/routes/` - File-based route definitions
  - `index.tsx` - Dashboard with stats and latest blocks
  - `blocks.tsx` - Blocks list page with pagination
  - `blocks.$height.tsx` - Block detail page
  - `transactions.$id.tsx` - Transaction detail page
  - `markets.tsx` - Markets list page
  - `markets.$id.tsx` - Market detail page with events
  - `address.$pubkey.tsx` - Address page (placeholder)
- `src/components/` - Reusable React components
  - `BlockCard.tsx` - Block display card
  - `TransactionList.tsx` - Transaction table component
  - `Pagination.tsx` - Pagination controls
  - `LoadingSpinner.tsx` - Loading state component
  - `ErrorMessage.tsx` - Error display component
  - `Header.tsx` - Navigation header with sidebar
- `src/components/ui/` - Shadcn UI components (auto-generated)
- `src/integrations/` - Third-party library integrations (TanStack Query setup)
- `src/hooks/` - Custom React hooks
  - `useApi.ts` - React Query hooks for API endpoints
  - `useBlockFeed.ts` - WebSocket hook for real-time block updates
- `src/lib/` - Utility functions
  - `api.ts` - API client with fetch wrapper
  - `formatters.ts` - Data formatting utilities (prices, timestamps, addresses)
  - `utils.ts` - General utilities (cn() helper)
- `src/types/` - TypeScript type definitions
  - `api.ts` - Complete API response types for Fermi rollup

### Path Aliases
The project uses `@/*` imports aliased to `./src/*`:
```typescript
import { cn } from '@/lib/utils'
import Header from '@/components/Header'
```

### DevTools
- TanStack DevTools unified panel (bottom-right) includes:
  - TanStack Router DevTools
  - TanStack Query DevTools
- Web Vitals reporting available via `reportWebVitals()`

## Code Style & Conventions

### Biome Configuration
- **Indentation**: Tabs (not spaces)
- **Quotes**: Double quotes for JavaScript/TypeScript
- **Import organization**: Auto-organize imports on format
- **Files checked**: `src/**/*`, `.vscode/**/*`, `index.html`, `vite.config.js`
- **Files excluded**: `src/routeTree.gen.ts` (auto-generated by TanStack Router)

### TypeScript
- Strict mode enabled
- No unused locals/parameters allowed
- Target: ES2022
- Module resolution: bundler mode

## Fermi Rollup API Integration

### Environment Variables
Configure API endpoints via environment variables:
- `VITE_API_BASE` - REST API base URL (default: `http://localhost:8080`)
- `VITE_WS_BASE` - WebSocket base URL (default: `ws://localhost:8080`)

### API Endpoints Used
- `GET /status` - Node status and chain info
- `GET /markets` - All configured markets
- `GET /blocks/latest` - Latest block with full details
- `GET /blocks/:height` - Specific block by height
- `GET /blocks?limit=X&offset=Y` - Paginated blocks list
- `GET /transactions/:id` - Transaction details
- `GET /events?market_id=X&limit=Y&offset=Z` - Market events
- `WS /ws/blocks` - Real-time block feed

### Data Formatting
- Prices: Stored as integers in smallest units (6 decimals for USDC)
- Quantities: Stored as integers (9 decimals for SOL)
- Timestamps: Unix seconds (not milliseconds) - convert with `* 1000` for JS Date
- Transaction IDs: Format `{block_height:016x}-{batch_index:04x}-{tx_index:04x}`
- Addresses: Base58-encoded Solana public keys

### WebSocket Integration
- Automatic reconnection with exponential backoff (max 30s)
- Real-time block updates broadcast to dashboard
- Connection status indicator in UI

## Important Notes

- Demo files prefixed with `demo` can be safely deleted
- Use `bun --bun` to ensure Bun runtime (not Node.js compatibility mode)
- Router auto-generates route types - don't manually edit `routeTree.gen.ts`
- Vite test config uses jsdom environment with globals enabled
- API client uses `import.meta.env` for Vite environment variables
- All API responses are typed in `src/types/api.ts`
- Address page is a placeholder - requires custom indexing to implement fully
